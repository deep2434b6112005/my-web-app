<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WalkBuddy</title>

    <link rel="stylesheet" href="walk.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      crossorigin="anonymous"
    />

    <!-- Leaflet CSS (Free Map) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
      /* RESET */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      /* HEADER */
      .header {
        background: #ffffff;
        padding: 15px 0;
        border-bottom: 1px solid #e0e0e0;
      }
      .navbar {
        display: flex;
        align-items: center;
        padding-left: 40px;
      }
      .logo {
        font-size: 24px;
        font-weight: bold;
        color: #1e8449;
      }

      /* ABOUT SECTION */
      .about-the-app {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 40px 80px;
        gap: 40px;
      }
      .about-the-app-container1 h1 {
        color: #1e8449;
        font-size: 55px;
      }
      .about-the-app-container1 p {
        color: #4a4a4a;
        line-height: 1.6;
        font-size: 20px;
      }
      .button-group button {
        box-shadow: 0 7px 29px rgba(100, 100, 111, 0.2);
        width: 160px;
        height: 50px;
        border-radius: 20px;
        margin: 10px;
        border: none;
        cursor: pointer;
        font-size: 16px;
      }
      .btn-primary {
        background: #1e8449;
        color: white;
      }
      .btn-secondary {
        background: #f2f2f2;
        color: #1e8449;
      }
      .image-container img {
        width: 500px;
        border-radius: 10px;
      }

      .button-group {
        display: flex;
      }

      /* QUICK BOOK */
      .quick-book {
        text-align: center;
        padding: 60px 40px;
        background-color: #f9f9f9;
      }
      .quick-book-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
        margin-top: 30px;
      }
      .quick-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
      }
      .quick-card img {
        width: 100%;
        border-radius: 20px;
        height: 300px;
        object-fit: cover;
      }
      .quick-card h3 {
        color: #4a4a4a;
        margin-top: 10px;
      }
      .quick-card p {
        color: #757575;
        font-size: 14px;
      }

      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }

      /* DASHBOARD */
      #dashboard {
        text-align: center;
        padding: 60px 40px;
      }
      #dashboard-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
        margin-top: 30px;
      }
      .dashboard-box {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .dashboard-box h2 {
        color: #1e8449;
        margin-bottom: 10px;
      }
      .dashboard-box a {
        color: #1e8449;
        text-decoration: none;
        font-weight: 600;
      }

      /* ENCOURAGE */
      .encourage {
        padding: 60px 40px;
        background: #f9fff9;
        text-align: center;
      }
      .encourage h1 {
        color: #1e8449;
        margin-bottom: 40px;
      }
      .encourage-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 30px;
      }
      .encourage-grid h3 {
        color: #1e8449;
      }
      .encourage-grid p {
        color: #4a4a4a;
        font-size: 15px;
      }

      /* BOTTOM NAV */
      .bar {
        display: flex;
        justify-content: space-around;
        background-color: #1e8449;
        color: white;
        padding: 10px 0;
      }
      .bar button {
        border: none;
        background: none;
        color: white;
        font-size: 14px;
        cursor: pointer;
      }
      .bar i {
        display: block;
        font-size: 18px;
        margin-bottom: 4px;
      }

      /* üåê RESPONSIVE MEDIA QUERIES */

      /* Tablet */
      @media (max-width: 992px) {
        .about-the-app {
          flex-direction: column;
          text-align: center;
          padding: 40px;
        }
        .about-the-app-container1 h1 {
          font-size: 40px;
        }
        .image-container img {
          width: 80%;
        }
      }

      /* Mobile */
      @media (max-width: 600px) {
        .about-the-app-container1 h1 {
          font-size: 28px;
        }
        .about-the-app-container1 p {
          font-size: 16px;
        }
        .image-container img {
          width: 100%;
        }
        .bar {
          flex-direction: column;
          gap: 10px;
        }
      }

      /* üåç FOOTER MENU RESPONSIVENESS */
      @media (min-width: 993px) {
        .bar {
          flex-direction: row;
          justify-content: space-evenly;
          align-items: center;
          padding: 15px 0;
        }
        .bar button {
          font-size: 16px;
        }
        .bar i {
          font-size: 20px;
        }
      }

      @media (max-width: 992px) and (min-width: 601px) {
        .bar {
          flex-direction: row;
          justify-content: space-around;
          padding: 10px 0;
        }
        .bar button {
          font-size: 14px;
        }
        .bar i {
          font-size: 18px;
        }
      }

      @media (max-width: 600px) {
        .bar {
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 15px 0;
          gap: 8px;
          bottom: 0;
          left: 0;
          width: 100%;
          z-index: 1000;
        }
        .bar button {
          font-size: 13px;
        }
        .bar i {
          font-size: 18px;
        }
      }
    </style>
  </head>

  <body>
    <!-- Header -->
    <header class="header">
      <nav class="navbar">
        <div class="logo">WalkBuddy</div>
      </nav>
    </header>

    <!-- About the App -->
    <section class="about-the-app">
      <div class="about-the-app-container1">
        <h1>Find walking buddies nearby ‚Äî walk safer, walk happier</h1>
        <p>
          Connect with like-minded individuals in your community who share your
          passion for walking. Enjoy the benefits of exercise, fresh air, and
          great company.
        </p>
        <div class="button-group">
          <button class="btn-primary">Find a Walk</button>
          <button class="btn-secondary">Browse Buddies</button>
        </div>
      </div>
      <div class="image-container">
        <img src="image/walk2.webp" alt="Walking buddies" />
      </div>
    </section>

    <!-- Quick Book -->
    <section class="quick-book">
      <h1>Quick Book</h1>
      <div class="quick-book-grid">
        <div class="quick-card">
          <img src="image/morning1.webp" alt="Morning Stroll" />
          <h3>Morning Stroll üåÖ</h3>
          <p>
            Kickstart your day with a refreshing walk. Connect with early birds
            and enjoy the quiet beauty of dawn.
          </p>
        </div>
        <div class="quick-card">
          <img src="image/evening1.webp" alt="Evening Walk" />
          <h3>Evening Walk üåÜ</h3>
          <p>
            Unwind after a long day. Perfect for a relaxed pace and friendly
            chats as the day winds down.
          </p>
        </div>
        <div class="quick-card">
          <img src="image/week1.webp" alt="Weekend Hike" />
          <h3>Weekend Hike üå≤</h3>
          <p>
            Explore nature trails and challenge yourself with invigorating
            weekend excursions. Discover new routes!
          </p>
        </div>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard">
      <h1>Your Walk Dashboard</h1>
      <div id="dashboard-content">
        <div class="dashboard-box">
          <h2>Walks Nearby</h2>
          <ul>
            <li>Loading nearby walks...</li>
          </ul>
          <a href="map.html">View All Nearby Walkers ‚Üí</a>
        </div>

        <div class="dashboard-box">
          <h2>Your Next Walk</h2>
          <p>Loading next walk...</p>
          <a href="bookslot.html">View Details</a>
        </div>

        <div class="dashboard-box">
          <h2>Your Walk Buddies</h2>
          <ul>
            <li>Loading buddies...</li>
          </ul>
          <a href="friend.html">Manage Buddies</a>
        </div>
      </div>
    </section>

    <!-- Bottom Navigation -->
    <footer class="bar">
      <button onclick="window.location.replace('walk.html')">
        <i class="fa-solid fa-house"></i>Home
      </button>
      <button onclick="window.location.replace('map.html')">
        <i class="fa-solid fa-map-location-dot"></i>MAP
      </button>
      <button onclick="window.location.replace('friend.html')">
        <i class="fa-solid fa-user-friends"></i>FRIENDS
      </button>

      <button onclick="window.location.replace('bookslot.html')">
        <i class="fa-solid fa-bookmark"></i>BOOKING
      </button>
      <button><i class="fa-solid fa-user"></i>Profile</button>
    </footer>

    <script>
      // ‚úÖ Slot booking
      document.querySelectorAll(".slot").forEach((img) => {
        img.addEventListener("click", async () => {
          const slotTitle = img.nextElementSibling.textContent;
          const confirmBooking = confirm(Book ${slotTitle}?);
          if (!confirmBooking) return;

          const today = new Date().toISOString().split("T")[0];

          const res = await fetch("/book", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              userEmail,
              buddyEmail: "buddy@example.com",
              slot: slotTitle,
              date: today,
            }),
          });

          const data = await res.json();
          alert(data.message);
        });
      });

      // Get logged in user from URL (like ?user=email@example.com)
      const urlParams = new URLSearchParams(window.location.search);
      const userEmail = urlParams.get("user");

      // ===== Load Nearby Users =====
      async function loadNearby() {
        if (!navigator.geolocation) {
          document.getElementById("nearbyList").innerHTML =
            "<li>Location not supported</li>";
          return;
        }

        navigator.geolocation.getCurrentPosition(async (pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;

          const res = await fetch(/nearby?lat=${lat}&lng=${lng});
          const users = await res.json();

          const list = document.getElementById("nearbyList");
          list.innerHTML = "";

          if (users.length === 0) {
            list.innerHTML = "<li>No nearby walkers found</li>";
          } else {
            users.forEach((u) => {
              const li = document.createElement("li");
              li.textContent = ${u.name} (${u.email});
              list.appendChild(li);
            });
          }
        });
      }

      // ===== Load Next Walk =====
      async function loadNextWalk() {
        const res = await fetch(/invites?email=${userEmail});
        const invites = await res.json();
        const nextWalkDiv = document.getElementById("nextWalk");

        if (invites.length === 0) {
          nextWalkDiv.innerHTML = "<p>No upcoming walks booked.</p>";
          return;
        }

        const next = invites[0];
        nextWalkDiv.innerHTML = `
      <p><b>Date:</b> ${next.date}</p>
      <p><b>Slot:</b> ${next.slot}</p>
      <p><b>Status:</b> ${next.status}</p>
      <p><b>With:</b> ${next.buddyEmail}</p>
    `;
      }

      // ===== Load Buddies =====
      async function loadBuddies() {
        const res = await fetch(/invites?email=${userEmail});
        const invites = await res.json();

        const buddyList = document.getElementById("buddyList");
        buddyList.innerHTML = "";

        if (invites.length === 0) {
          buddyList.innerHTML = "<li>No buddies yet.</li>";
          return;
        }

        const buddies = new Set();
        invites.forEach((i) => {
          buddies.add(i.userEmail === userEmail ? i.buddyEmail : i.userEmail);
        });

        buddies.forEach((b) => {
          const li = document.createElement("li");
          li.textContent = b;
          buddyList.appendChild(li);
        });
      }

      // ===== Initialize Dashboard =====
      window.addEventListener("load", () => {
        if (!userEmail) {
          alert("Please log in first!");
          window.location.href = "/login.html";
          return;
        }

        loadNearby();
        loadNextWalk();
        loadBuddies();
      });
    </script>
  </body>
</html>
